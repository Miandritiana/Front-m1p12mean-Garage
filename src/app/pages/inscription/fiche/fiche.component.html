
<c-row >
    <c-col xs="12">
        <h5> Inscription concours: {{ concours?.viewConcours!.idConcours }}  
            <c-badge [color]="getColorStatut(concours?.viewConcours!.etat!)">
                {{ concours?.viewConcours!.etatConcours}}
            </c-badge>
        </h5>
    </c-col>
</c-row>
<c-row ngPreserveWhitespaces class="mb-4">
    <c-col xs="8">
        
            <c-card>
                <c-card-header>
                    <h5 class="m-0 p-2">Information sur le candidat</h5>
                </c-card-header>
                <c-card-body>
                    <div class="accordion-body">
                        <dl class="row">
                            <dt class="col-sm-4">Nom(s): </dt>
                            <dd class="col-sm-8">{{ concours?.viewConcours!.nom }}</dd>

                            <dt class="col-sm-4">Prenom(s): </dt>
                            <dd class="col-sm-8">{{ concours?.viewConcours!.prenom }}</dd>
                            
                            <dt class="col-sm-4">Contact téléphonique: </dt>
                            <dd class="col-sm-8">{{ concours?.viewConcours!.contact }}</dd>
                            
                            <dt class="col-sm-4">Adresse e-mail: </dt>
                            <dd class="col-sm-8">{{ concours?.viewConcours!.email }}</dd>
                            
                            <dt class="col-sm-4">Date de l'inscription: </dt>
                            <dd class="col-sm-8">{{ formatedDate(concours?.viewConcours!.dateInscription!) }}</dd>
                            
                        </dl>
                    </div>
                </c-card-body>
            </c-card>

            <c-card class="mt-3">
                <c-card-header>
                    <h5 class="m-0 p-2">Information sur le concours</h5>
                </c-card-header>
                <c-card-body>
                    <div class="accordion-body">
                        <c-row>
                            <c-col>
                                <dl class="row">
                                    <dt class="col-sm-4">Date Ecrit: </dt>
                                    <dd class="col-sm-8">{{ formatedDate(concours?.viewConcours!.dateConcoursEcrit!) }}</dd>
                                    
                                    <dt class="col-sm-4">Date oral: </dt>
                                    <dd class="col-sm-8">{{concours?.viewConcours!.dateConcoursOral}}</dd>
                                    
                                    <dt class="col-sm-4">Heure horal: </dt>
                                    <dd class="col-sm-8">{{concours?.viewConcours!.typePresentation==0?"En ligne" :"Présentiel"}}</dd>

                                    <dt class="col-sm-4">Type oral: </dt>
                                    <dd class="col-sm-8">{{concours?.viewConcours!.heureDebut}}</dd>
                                    
                                    <dt class="col-sm-4">Campus:</dt>
                                    <dd class="col-sm-8">{{concours?.viewConcours!.nomCampus}}</dd>
                                    
                                    <dt class="col-sm-4">Niveau: </dt>
                                    <dd class="col-sm-8">{{concours?.viewConcours!.niveau}}</dd>

                                    <dt class="col-sm-4">Parcours: </dt>
                                    <dd class="col-sm-8">{{concours?.viewConcours!.parcours}}</dd>

                                    <dt class="col-sm-4">Mode de payement: </dt>
                                    <dd class="col-sm-8">{{concours?.viewConcours!.modePaiement==1?"Versement à la banque":"En ligne"}}</dd>
                                </dl>
                            </c-col>
                            
                        </c-row>
                    </div>
                </c-card-body>
            </c-card>

            <c-card class="mt-3">
                <c-card-header>
                    <h5 class="m-0 p-2">Dossiers</h5>
                </c-card-header>
                <c-card-body>
                    <div class="accordion-body">
                        <div class="table-responsive">
                            <table cTable>
                                <tbody>
                                    <tr *ngFor="let liste of concours?.viewDossierConcours">
                                        <td>{{ liste.nomDossier }}</td>
                                        <td class="text-wrap" class="text-center">
                                            <button cButton color="link" (click)="openFichier(liste.nomFichier)"
                                            cTooltip="Voir document" cTooltipPlacement="top">
                                                <svg cIcon name="cil-file" size="l" title="Action"
                                                            style="color: #5856d6;"></svg>
                                            </button>
                                        </td>
                                        <td *ngIf="concours?.viewConcours!.etat >= 11">
                                            <div *ngIf="liste.etat == 1; else elseIcon">
                                                <c-row>
                                                    <c-col>
                                                        <button cButton variant="ghost" color="light"
                                                        cTooltip="Dossier valide" cTooltipPlacement="top"
                                                        (click)="onDossierChecked(liste.idDossierConcours)">
                                                            <svg cIcon name="cil-check" size="l" title="Action" 
                                                            style="color: green;"></svg>
                                                        </button>

                                                        <button cButton variant="ghost" color="light"
                                                        cTooltip="Dossier non-valide" cTooltipPlacement="top"
                                                        (click)="onDossierUnChecked(liste.idDossierConcours)">
                                                            <svg cIcon name="cil-x" size="l" title="Action"
                                                            style="color: orangered;"></svg>
                                                        </button>
                                                    </c-col>
                                                </c-row>
                                            </div>
                                            <ng-template #elseIcon>
                                                <div class="text-center">
                                                    <svg cIcon name="cil-check-circle" size="l" title="Action"
                                                    *ngIf="liste.etat == 2; else elseIconElse"
                                                    style="color: green;"></svg>
    
                                                    <ng-template #elseIconElse>
                                                        <svg cIcon name="cil-warning" size="l" title="Action"
                                                        style="color: orangered;"></svg>
                                                    </ng-template>
                                                </div>
                                            </ng-template>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </c-card-body>
            </c-card>


        <div class="mt-4">
            <dl class="row">
                <dt class="col-sm-12 d-flex justify-content-end">

                    <button *ngIf="concours?.viewConcours!.etat==1" (click)="validerRecouvrement()"
                    cButton class="w-50">
                        Valider recouvrement
                    </button>

                    <button *ngIf="concours?.viewConcours!.etat==11" cButton color="success" class="text-white" 
                    (click)="valider()"
                    [disabled]="isValid()">
                        <svg cIcon name="cil-check-alt" size="l" title="Action"></svg>
                        Valider
                    </button>

                    <c-modal #verticallyCenteredModal alignment="center" id="verticallyCenteredModal">
                    <c-modal-header>
                        <h5 cModalTitle>Modal title</h5>
                        <button [cModalToggle]="verticallyCenteredModal.id" cButtonClose></button>
                    </c-modal-header>
                    <c-modal-body>
                        <label>Numéro</label>
                        <input cFormControl id="inputEmail-1" type="text" [(ngModel)]="numero">
                        <br>
                        <label>Montant</label>
                        <input cFormControl id="inputEmail-1" type="number" [(ngModel)]="montant">
                        <br>
                        <label>Caisse</label>
                        <select aria-label="Default select example" cSelect [(ngModel)]="idCaisse">
                            <option>Caisse</option>
                            <option value="1" *ngFor="let liste of listeCaisse">{{ liste.nomCaisse }} - n°{{ liste.numeroCaisse }}</option>
                        </select>
                    </c-modal-body>
                    <c-modal-footer>
                        <button [cModalToggle]="verticallyCenteredModal.id" 
                        cButton color="danger" class="text-white">
                            <svg cIcon name="cil-x" size="l" title="Action"></svg>
                            Annuler
                        </button>
                        <button cButton color="success" class="text-white" (click)="validerRecouvrement()">
                            <svg cIcon name="cil-check-alt" size="l" title="Action"></svg>
                            Valider
                        </button>
                    </c-modal-footer>
                    </c-modal>
                </dt>
            </dl>
        </div>
    </c-col>

    <c-col xs="4">
        <c-card class="p-3 fixed-sidebar">
            <c-card-body>
                <h4><strong>Historique concours</strong></h4>
                <p class="text-muted">Les étapes effectuées durant le processus d’inscription</p>
                
                <ul class="list-unstyled">
                    <li *ngFor="let item of historiqueConcours" class="d-flex align-items-center mb-3">
                        <span class="text-primary me-2">
                            <svg cIcon name="cil-check-circle" size="xl" title="Action"></svg>
                        </span>
                        <div>
                            <strong> {{ item.titreEtat }}</strong>
                            <p class="m-0 text-muted">{{ item.dateSaisie  | date: 'dd/MM/yyyy HH:mm' }} • {{ item.nom }}</p>
                        </div>
                    </li>
                </ul>
            </c-card-body>
        </c-card>
    </c-col>
</c-row>
